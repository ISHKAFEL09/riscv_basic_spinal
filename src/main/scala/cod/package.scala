import spinal.core._
import spinal.lib._

package object cod {
  def debug(x: Any) = {
    if (GenConfig().verbose) println(x)
  }

  val ctrlSize = 4 bits
  val xprWidth = GenConfig().xprlen bits
  val btbWidth = GenConfig().btbSize bits

  object Const {
    val StartAddress = U(0, xprWidth)

    object PCSel extends SpinalEnum {
      val plus4, jump, excp, start, extra = newElement()
    }

    object BranchSel extends SpinalEnum {
      val nop, beq, bne, blt, bltu, bge, bgeu, jump, extra = newElement()
    }

    object AluSrc extends SpinalEnum {
      val rf, imm, pc, csr, extra = newElement()
    }

    object WbSrc extends SpinalEnum {
      val alu, mem, extra = newElement()
    }

    object MemoryOp extends SpinalEnum {
      val mt_x, mt_b, mt_h, mt_w, mt_d, mt_bu, mt_hu, mt_wu = newElement()
      val m_x, m_xrd, m_xwr = newElement()
    }

    object InstrType extends SpinalEnum {
      val typeN, typeR, typeI, typeS, typeB, typeU, typeJ, extra = newElement()
    }

    object AluOpType extends SpinalEnum {
      val add, addu, sub, and, or, xor = newElement()
      val bypass1, bypass2, lshift, rshift = newElement()
      val rshifta, comp, compu, nop = newElement()
    }

    object InstrFlag {
      val nop = U(0)
      val isBranch = U(1 << 0)
      val isLoad = U(1 << 1)
      val isStore = U(1 << 2)
      val isCsr = U(1 << 3)
      val isJump = U(1 << 4)
    }

    object ImmType extends SpinalEnum {
      val typeN, typeI, typeB, typeS, typeU, typeJ, addPc = newElement()
    }

    object Instruction {
      val BUBBLE             = M"b00000000000000000100000000110011"
      val BEQ                = M"b?????????????????000?????1100011"
      val BNE                = M"b?????????????????001?????1100011"
      val BLT                = M"b?????????????????100?????1100011"
      val BGE                = M"b?????????????????101?????1100011"
      val BLTU               = M"b?????????????????110?????1100011"
      val BGEU               = M"b?????????????????111?????1100011"
      val JALR               = M"b?????????????????000?????1100111"
      val JAL                = M"b?????????????????????????1101111"
      val LUI                = M"b?????????????????????????0110111"
      val AUIPC              = M"b?????????????????????????0010111"
      val ADDI               = M"b?????????????????000?????0010011"
      val SLLI               = M"b000000???????????001?????0010011"
      val SLTI               = M"b?????????????????010?????0010011"
      val SLTIU              = M"b?????????????????011?????0010011"
      val XORI               = M"b?????????????????100?????0010011"
      val SRLI               = M"b000000???????????101?????0010011"
      val SRAI               = M"b010000???????????101?????0010011"
      val ORI                = M"b?????????????????110?????0010011"
      val ANDI               = M"b?????????????????111?????0010011"
      val ADD                = M"b0000000??????????000?????0110011"
      val SUB                = M"b0100000??????????000?????0110011"
      val SLL                = M"b0000000??????????001?????0110011"
      val SLT                = M"b0000000??????????010?????0110011"
      val SLTU               = M"b0000000??????????011?????0110011"
      val XOR                = M"b0000000??????????100?????0110011"
      val SRL                = M"b0000000??????????101?????0110011"
      val SRA                = M"b0100000??????????101?????0110011"
      val OR                 = M"b0000000??????????110?????0110011"
      val AND                = M"b0000000??????????111?????0110011"
      val ADDIW              = M"b?????????????????000?????0011011"
      val SLLIW              = M"b0000000??????????001?????0011011"
      val SRLIW              = M"b0000000??????????101?????0011011"
      val SRAIW              = M"b0100000??????????101?????0011011"
      val ADDW               = M"b0000000??????????000?????0111011"
      val SUBW               = M"b0100000??????????000?????0111011"
      val SLLW               = M"b0000000??????????001?????0111011"
      val SRLW               = M"b0000000??????????101?????0111011"
      val SRAW               = M"b0100000??????????101?????0111011"
      val LB                 = M"b?????????????????000?????0000011"
      val LH                 = M"b?????????????????001?????0000011"
      val LW                 = M"b?????????????????010?????0000011"
      val LD                 = M"b?????????????????011?????0000011"
      val LBU                = M"b?????????????????100?????0000011"
      val LHU                = M"b?????????????????101?????0000011"
      val LWU                = M"b?????????????????110?????0000011"
      val SB                 = M"b?????????????????000?????0100011"
      val SH                 = M"b?????????????????001?????0100011"
      val SW                 = M"b?????????????????010?????0100011"
      val SD                 = M"b?????????????????011?????0100011"
      val FENCE              = M"b?????????????????000?????0001111"
      val FENCE_I            = M"b?????????????????001?????0001111"
      val MUL                = M"b0000001??????????000?????0110011"
      val MULH               = M"b0000001??????????001?????0110011"
      val MULHSU             = M"b0000001??????????010?????0110011"
      val MULHU              = M"b0000001??????????011?????0110011"
      val DIV                = M"b0000001??????????100?????0110011"
      val DIVU               = M"b0000001??????????101?????0110011"
      val REM                = M"b0000001??????????110?????0110011"
      val REMU               = M"b0000001??????????111?????0110011"
      val MULW               = M"b0000001??????????000?????0111011"
      val DIVW               = M"b0000001??????????100?????0111011"
      val DIVUW              = M"b0000001??????????101?????0111011"
      val REMW               = M"b0000001??????????110?????0111011"
      val REMUW              = M"b0000001??????????111?????0111011"
      val LR_W               = M"b00010??00000?????010?????0101111"
      val SC_W               = M"b00011????????????010?????0101111"
      val LR_D               = M"b00010??00000?????011?????0101111"
      val SC_D               = M"b00011????????????011?????0101111"
      val ECALL              = M"b00000000000000000000000001110011"
      val EBREAK             = M"b00000000000100000000000001110011"
      val URET               = M"b00000000001000000000000001110011"
      val MRET               = M"b00110000001000000000000001110011"
      val DRET               = M"b01111011001000000000000001110011"
      val SFENCE_VMA         = M"b0001001??????????000000001110011"
      val WFI                = M"b00010000010100000000000001110011"
      val CSRRW              = M"b?????????????????001?????1110011"
      val CSRRS              = M"b?????????????????010?????1110011"
      val CSRRC              = M"b?????????????????011?????1110011"
      val CSRRWI             = M"b?????????????????101?????1110011"
      val CSRRSI             = M"b?????????????????110?????1110011"
      val CSRRCI             = M"b?????????????????111?????1110011"
      val CUSTOM0            = M"b?????????????????000?????0001011"
      val CUSTOM0_RS1        = M"b?????????????????010?????0001011"
      val CUSTOM0_RS1_RS2    = M"b?????????????????011?????0001011"
      val CUSTOM0_RD         = M"b?????????????????100?????0001011"
      val CUSTOM0_RD_RS1     = M"b?????????????????110?????0001011"
      val CUSTOM0_RD_RS1_RS2 = M"b?????????????????111?????0001011"
      val CUSTOM1            = M"b?????????????????000?????0101011"
      val CUSTOM1_RS1        = M"b?????????????????010?????0101011"
      val CUSTOM1_RS1_RS2    = M"b?????????????????011?????0101011"
      val CUSTOM1_RD         = M"b?????????????????100?????0101011"
      val CUSTOM1_RD_RS1     = M"b?????????????????110?????0101011"
      val CUSTOM1_RD_RS1_RS2 = M"b?????????????????111?????0101011"
      val CUSTOM2            = M"b?????????????????000?????1011011"
      val CUSTOM2_RS1        = M"b?????????????????010?????1011011"
      val CUSTOM2_RS1_RS2    = M"b?????????????????011?????1011011"
      val CUSTOM2_RD         = M"b?????????????????100?????1011011"
      val CUSTOM2_RD_RS1     = M"b?????????????????110?????1011011"
      val CUSTOM2_RD_RS1_RS2 = M"b?????????????????111?????1011011"
      val CUSTOM3            = M"b?????????????????000?????1111011"
      val CUSTOM3_RS1        = M"b?????????????????010?????1111011"
      val CUSTOM3_RS1_RS2    = M"b?????????????????011?????1111011"
      val CUSTOM3_RD         = M"b?????????????????100?????1111012"
      val CUSTOM3_RD_RS1     = M"b?????????????????110?????1111011"
      val CUSTOM3_RD_RS1_RS2 = M"b?????????????????111?????1111011"
      val SLLI_RV32          = M"b0000000??????????001?????0010011"
      val SRLI_RV32          = M"b0000000??????????101?????0010011"
      val SRAI_RV32          = M"b0100000??????????101?????0010011"
      val RDCYCLE            = M"b11000000000000000010?????1110011"
      val RDTIME             = M"b11000000000100000010?????1110011"
      val RDINSTRET          = M"b11000000001000000010?????1110011"
      val RDCYCLEH           = M"b11001000000000000010?????1110011"
      val RDTIMEH            = M"b11001000000100000010?????1110011"
      val RDINSTRETH         = M"b11001000001000000010?????1110011"
    }
  }

  case class GenConfig() {
    val xprlen = 32
    val nxpr = 32
    val btbSize = 1024
    val verbose = true
    val nxprbits = log2Up(nxpr)
    val rvc = false
    val vm = false
    val usingUser = false
    val innerIMem = true
    val debugOn = true
    val testCase = "tests/isa/rv32ui-p-add"
  }
}
